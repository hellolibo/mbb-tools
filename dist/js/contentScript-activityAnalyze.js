$(function(){"use strict";function a(a){var e=$.ajax({url:"http://dashboard.mbaobao.com/data/indexPvServlet?page=a-&url_key="+a+"&d="+(new Date).getTime(),type:"GET",dataType:"JSON"});e.done(function(a){console.log("path match log:"),console.groupCollapsed(),$("body").on("mouseenter","a,form, .mt-map-area",function(){var a=$(this).find(".mt-point");a.length&&(a.hide(),c(this))}).on("mouseleave","a, form, .mt-map-area",function(){var a=$(this).find(".mt-point");a.length&&(a.show(),d())}),$("body").on("mouseenter",".mt-map-area",function(){$(this).css({"background-color":"rgba(0,0,0,0.4)"})}).on("mouseleave",".mt-map-area",function(){$(this).css({"background-color":"rgba(0,0,0,0)"})}).on("click",".mt-map-area",function(){window.open($(this).data("href"))}),console.log("a link match fail:"),console.group(),$("a").each(function(c,d){var e=$(d),f=e.attr("href"),g=f;if(g&&"#"!=g.charAt(0)){g=g.replace(/\s+\?/,"?").replace(/\.com(\?.+)?$/,".com/$1").replace(/\?p=[0-9]+/,"");var h=a[g];h?b(h,e):console.log("fail:",f)}}),console.groupEnd(),console.log("img map match fail:"),console.group(),$("img").each(function(){var c=$(this),d=c.attr("usemap"),e=c.attr("src2");if(e&&c.attr({src:e}).removeAttr("src2"),d){var g=c.wrap("<div/>").parent().css({"float":c.css("float"),width:c.width(),height:c.height(),position:"relative"});$("map[name="+d.substr(1)+"]").find("area").each(function(){var c=$(this).attr("href");if(c&&"#"!=c.charAt(0)){var d=c.replace(/\s+\?/,"?").replace(/\.com(\?.+)?$/,".com/$1").replace(/\?p=[0-9]+/,""),e=a[d],h=f($(this).attr("shape"),$(this).attr("coords"));h.data({href:$(this).attr("href")}),g.append(h),e?b(e,h):console.log("fail:",c)}})}}),console.groupEnd(),$("form").each(function(c,d){var e=$(d).attr("action"),f=a[e];f&&b(f,$(d))}),console.groupEnd()})}function b(a,b,c){setTimeout(function(){var d=$(document.createElement("b")).addClass("mt-point").html(a.ratio),e=b.css("position");(!e||"relative"!=e&&"absolute"!=e)&&b.css({position:"relative"}),c&&d.css(c),b.append(d).data(a)},100*h),h+=1,h>4&&(h=1)}function c(a){var b=e(),c=$(a).offset(),d=$(a).data(),f=c.top-44;0>=f&&(f=c.top+20),b.css({top:f,left:c.left}).html("<div>"+d.ratio+"</div><div>"+d.pv+"</div>").show()}function d(){e().hide()}function e(){var a=$("body").find(".mt-tip");return a.length||(a=$(document.createElement("div")).addClass("mt-tip").appendTo("body")),a}function f(a,b){var c=_.map(b.split(","),function(a){return parseInt(a,10)}),d=0,e=0,f="",h=0,i=0;if("rect"==a&&(d=Math.abs(c[0]-c[2]),e=Math.abs(c[1]-c[3]),h=c[1],i=c[0]),"circle"==a&&(d=e=2*c[2],h=c[1],i=c[0]),"poly"==a){var j=g(c);d=Math.abs(j[0]-j[2]),e=Math.abs(j[1]-j[3]),h=j[1],i=j[0]}return f='<div class="mt-map-area" style="cursor:pointer;position:absolute;width:'+d+"px;height:"+e+"px;left:"+i+"px;top:"+h+'px"/>',$(f)}function g(a){var b=_.filter(a,function(a,b){return(b+1)%2>0}),c=_.filter(a,function(a,b){return 0===(b+1)%2}),d=_.max(b),e=_.min(b),f=_.max(c),g=_.min(c);return[e,g,d,f]}$("a");var h=1;chrome.runtime.sendMessage({action:"getActivityPageName"},function(b){a(b.activityPageName)})});